name: CI Integrations
run-name: ${{ github.actor }} is running CI üöÄ
on:
  push:
    branches:
      - master
jobs:
  CI-Job:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18.x
      - name: Docker login
        run: |
          echo ${{ secrets.docker_password }} | docker login --username ${{ secrets.docker_username }} --password-stdin
      - name: Verify Docker connection
        run: |
          docker run hello-world
      - name: Check version
        run: |
          local_version=$(cat package.json | grep dockerVersion | tr -cd '[:digit:].')
          remote_version=$(docker pull milenibgd/exemplify-ci-cd:${local_version} || echo "")
          if [[ $local_version != $remote_version ]]; then
            echo "Image with a tag $local_version does not exist."
            echo "NEW_BUILD_VERSION=${local_version}" >> $GITHUB_ENV
          else
            echo "Image with a tag $local_version already exists."
          fi
      - name: Build Docker image
        if: ${{ env.NEW_BUILD_VERSION }}
        run: |
          echo "Creating new image..."
          docker build -t milenibgd/exemplify-ci-cd:${{ env.NEW_BUILD_VERSION }}
          docker push milenibgd/exemplify-ci-cd:${{ env.NEW_BUILD_VERSION }}
      - run: echo "üçè This job's status is ${{ job.status }}."
